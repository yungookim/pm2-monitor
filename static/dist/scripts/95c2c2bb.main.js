(function(){window.pm2Monitor={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";return new this.Routers.MainRouter,Backbone.history.start(),console.log("Hello from Backbone!"),$.get("api/server_list",function(a){return _.each(a,function(a){var b;return a=a.replace(/\//g,"&#47;"),b=$("<a/>").attr("href","#remote/"+a).html(a),$("#remote_list").prepend($("<li/>").html(b))})})}},$(function(){"use strict";return pm2Monitor.init()})}).call(this),this.JST={"cpu-template":'{{#monit.cpu}}<div class="col-lg-6"><div class="panel panel-info"><div class="panel-heading"><div class="row"><div class="col-xs-12">{{model}} - {{speed}}</div></div><hr><div class="row"><div class="col-xs-12"><p>User : {{times.user}} </p><p>Nice : {{times.nice}} </p><p>System : {{times.sys}} </p><p>Idel : {{times.idle}} </p><p>Interrupt Request(IRQ) : {{times.irq}} </p></div></div></div></div></div>{{/monit.cpu}}',"main-template":'<div class="divider"></div><h1>System <small>{{system_info.hostname}}</small></h1><p>System Uptime : {{system_info.uptime}}</p><p data-toggle="tooltip" title="1-minute, 5-minute and 15-minute average" class="pointer">Load Averages{{#monit.loadavg}}<span class="label load_avg" style="margin:10px;">{{.}}</span>{{/monit.loadavg}}</p><div class="row"><div class="col-lg-6"><h3>Load Average</h3><div id="load_avg"></div></div><div class="col-lg-6"><h3>Memory</h3><div id="memory_graph"></div></div></div><div id="cpu_graphs" class="row"><h3>CPU<button type="button" class="btn btn-default" data-toggle="collapse" data-target="#cpu_details" style="margin-left:10px;">Details</button></h3><div id="cpu_details" class="collapse"></div></div><h1>Processes</h1><div clas=s"row"><div class="col-lg-12"><table class="table table-bordered"><thead><tr><th>Status</th><th>PID</th><th>pm_id</th><th>Path</th><th>Name</th><th>Name</th><th>User</th><th>Mode</th><th>Details</th></tr></thead><tbody id="process_table"></tbody></table></div></div>',"process-template":'{{#processes}}<tr><td class="status-col"><span class="label label-{{pm2_env.status}}">{{pm2_env.status}}</span></td><td>{{pid}}</td><td>{{pm_id}}</td><td>{{pm2_env.pm_exec_path}}</td><td>{{pm2_env.name}}</td><td>{{pm2_env.name}}</td><td>{{pm2_env.env.USER}}</td><td>{{pm2_env.exec_mode}}</td><td><button type="button" class="btn btn-link" data-toggle="collapse" data-target="#detail_{{pid}}">Show Details</button><div id="detail_{{pid}}" class="collapse"><p><b>Outlog</b> {{pm2_env.pm_out_log_path}}</p><p><b>Errlog</b> {{pm2_env.pm_err_log_path}}</p><p><b>Restarts</b> {{pm2_env.restart_time}}</p><p class="text-danger"><b>Unstable Restarts</b> {{pm2_env.unstable_restarts}}</p><p><b>Created At</b> {{pm2_env.created_at}}</p><p><b>Uptime</b> {{pm2_env.pm_uptime}}</p><p><b>Memory</b> {{monit.memory}}</p><p><b>CPU</b> {{monit.cpu}}</p></div></td></tr><!--<tr><td></td><th>Outlog</th><th>Errlog</th><th>Restarts</th><th>Unstable Restarts</th><th>Created At</th><th>Uptime</th><th>Memory</th><th>CPU</th></tr><tr><td></td><td>{{pm2_env.pm_out_log_path}}</td><td>{{pm2_env.pm_err_log_path}}</td><td>{{pm2_env.restart_time}}</td><td class="text-danger">{{pm2_env.unstable_restarts}}</td><td>{{pm2_env.created_at}}</td><td>{{pm2_env.pm_uptime}}</td><td>{{monit.memory}}</td><td>{{monit.cpu}}</td></tr>-->{{/processes}}',done:"true"},function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};pm2Monitor.Views.DashboardView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.initialize=function(){var a=this;return this.template=window.JST["main-template"],this.listenTo(this.model,"change",this.render),window.setInterval(function(){return console.log("fetching..."),a.model.fetch()},1e4)},d.prototype.render=function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON())),this.render_graphs()},d.prototype.render_graphs=function(){return this.load_avg_indicators(),this.memory_graph(),this.load_avg_graphs(),this.cpu_graphs(),this.process_tables()},d.prototype.load_avg_indicators=function(){return _.each($(".load_avg"),function(a){var b;return b=parseFloat($(a).html()),.7>b?$(a).addClass("label-success"):b>.7&&.85>b?$(a).addClass("label-warning"):b>.85?$(a).addClass("label-danger"):void 0})},d.prototype.memory_graph=function(){var a,b,c,d;return a=this.model.get("monit").free_mem,b=100*(a/this.model.get("monit").total_mem).toFixed(2),c=this.model.get("monit").total_mem-a,d=100*(c/this.model.get("monit").total_mem).toFixed(2),Morris.Donut({element:"memory_graph",data:[{label:"Free",value:b},{label:"Used",value:d}],formatter:function(a){return a+"%"}})},d.prototype.load_avg_graphs=function(){return Morris.Bar({element:"load_avg",data:[{y:"",one:this.model.get("monit").loadavg[0].toFixed(2),five:this.model.get("monit").loadavg[1].toFixed(2),fifteen:this.model.get("monit").loadavg[2].toFixed(2)}],xkey:"y",ykeys:["one","five","fifteen"],labels:["1-min","5-min","15-min"],grid:!1})},d.prototype.cpu_graphs=function(){var a,b;return b=window.JST["cpu-template"],$("#cpu_details").html(Mustache.render(b,this.model.toJSON())),a=this.model.get("monit").cpu,_.each(a,function(a){var b,c,d,e,f,g,h,i;return e=a.times.user+a.times.nice+a.times.sys+a.times.idle,f=(100*(a.times.user/e)).toFixed(2),c=(100*(a.times.nice/e)).toFixed(2),d=(100*(a.times.sys/e)).toFixed(2),b=(100*(a.times.idle/e)).toFixed(2),a.times.total=e,i=(Math.random()/+new Date).toString(36).replace(/[^a-z]+/g,""),g=$("<div/>").addClass("col-lg-6"),h=$("<div/>").attr("id",i),g.html(h),$("#cpu_graphs").append(g),Morris.Donut({element:i,data:[{label:"user",value:f},{label:"nice",value:c},{label:"system",value:d},{label:"idle",value:b}],formatter:function(a){return a+"%"}})})},d.prototype.process_tables=function(){var a,b;return a=$("#process_table"),b=window.JST["process-template"],a.html(Mustache.render(b,this.model.toJSON()))},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};pm2Monitor.Routers.MainRouter=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.routes={"":"home","remote/:url":"load_remote"},d.prototype.initialize=function(){return window.pm2Monitor.Globals={}},d.prototype.home=function(){return new pm2Monitor.Views.DashboardView({el:$("#content"),model:new pm2Monitor.Models.Pm2AppModel})},d.prototype.load_remote=function(a){return new pm2Monitor.Views.DashboardView({el:$("#content"),model:new pm2Monitor.Models.Pm2AppModel({url:a})})},d}(Backbone.Router)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};pm2Monitor.Models.Pm2AppModel=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.urlRoot="/api/local",d.prototype.defaults={system_info:{hostname:"",uptime:0},monit:{loadavg:[0,0,0],total_mem:0,free_mem:0,cpu:[{model:"",speed:0,times:{user:0,nice:0,sys:0,idle:0,irq:0}}]},processes:[{pid:0,pm_id:0,pm2_env:{name:"",env:{USER:""},exec_mode:"",pm_exec_path:"",pm_out_log_path:"",pm_err_log_path:"",pm_id:0,restart_time:0,unstable_restarts:0,created_at:0,pm_uptime:0,status:""},monit:{memory:0,cpu:0}}]},d.prototype.initialize=function(a){var b=this;return a&&a.url&&(a.url=a.url.replace(/&#47;/g,"/"),this.urlRoot="/api/remote",this.set("id",a.url)),this.fetch({success:function(a){return b.get("system_info").uptime_hour=a.get("system_info").uptime%3600,console.log("PM2 stats loaded")},error:function(a,b){return alert(b),console.log("Error while loading PM2 stats")}})},d}(Backbone.Model)}.call(this);